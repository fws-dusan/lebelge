var Modal,wcap_clicked_cart_id,$wcap_get_email_address,$wcap_customer_details,$wcap_cart_total,$wcap_abandoned_date,$wcap_abandoned_status,email_body,$wcap_cart_status,$wcap_show_customer_detail;jQuery(function(a){(Modal={init:function(){a(document.body).on("click",".wcap-js-close-modal",this.close),a(document.body).on("click",".wcap-modal-overlay",this.close),a(document.body).on("click",".wcap-js-open-modal",this.handle_link),a(document.body).on("click",".wcap-js-edit_email",this.edit_email_popup),a(document.body).on("click",".wcap-mark-recovered-action",this.mark_recovered_popup),a(document.body).on("click",".wcap_search_wc_order",this.search_order),a(document.body).on("click",".wcap_mark_recovered_admin",this.mark_recovered_update),a(document.body).on("click",".wcap_customer_detail_modal",this.handle_customer_details),a(document.body).on("mousedown",".wcap-js-open-modal",this.handle_link_mouse_middle_click),a(document.body).on("click",".wcap_admin_unsubscribe",this.wcap_admin_unsubscribe),a(document.body).on("click",".wcap_update_email",this.wcap_update_email),a(window).resize(function(){Modal.position()}),a(document).keydown(function(a){27==a.keyCode&&Modal.close()})},handle_customer_details:function(e){e.preventDefault(),-1==a(e.target).text().indexOf("Hide")?(a(".wcap_modal_customer_all_details").fadeIn(),Modal.position(),a(e.target).text("Hide Details")):(a(".wcap_modal_customer_all_details").fadeOut(),Modal.position(),a(e.target).text("Show Details"))},handle_link_mouse_middle_click:function(a){if(2==a.which){var e=window.location.href;return this.href=e,a.preventDefault(),!1}},handle_link:function(e){e.preventDefault();var t,d,c=a(this),o="";if(-1==window.location.href.indexOf("action=emailstats")?(t=(d=c.closest("tr")[0]).getElementsByTagName("td")[1].innerHTML.split("<div")[0],$wcap_customer_details=d.getElementsByTagName("td")[2].innerHTML,$wcap_cart_total=d.getElementsByTagName("td")[3].innerHTML,$wcap_abandoned_date=d.getElementsByTagName("td")[4].innerHTML,$wcap_abandoned_status=d.getElementsByClassName("status")[0].firstChild.innerText,$wcap_cart_status=$wcap_abandoned_status):(o="send_email",t="",$wcap_customer_details="",$wcap_cart_total="",$wcap_abandoned_date="",$wcap_cart_status=""),email_body='<div class="wcap-modal__body"> <div class="wcap-modal__body-inner"> <table cellspacing="0" cellpadding="6" border="1" class="wcap-cart-table"> <thead><th>Email Address</th><th>Customer Details</th><th>Order Total</th><th> Abandoned Date</th></tr></thead><tbody><tr><td>'+t+"</td><td>"+$wcap_customer_details+($wcap_show_customer_detail='<br><a href="#" id "wcap_customer_detail_modal"> Show Details </a>')+"</td><td>"+$wcap_cart_total+" </td><td>"+$wcap_abandoned_date+" </td></tr></tbody></table></div> </div>","ajax"==c.data("modal-type")){wcap_clicked_cart_id=c.data("wcap-cart-id"),Modal.open("type-ajax"),Modal.loading();var i={action:"wcap_abandoned_cart_info",wcap_cart_id:wcap_clicked_cart_id,wcap_email_address:t,wcap_customer_details:$wcap_customer_details,wcap_cart_total:$wcap_cart_total,wcap_abandoned_date:$wcap_abandoned_date,wcap_abandoned_status:$wcap_cart_status,wcap_current_page:o};a.post(ajaxurl,i,function(a){Modal.contents(a)})}},edit_email_popup:function(e){e.preventDefault();var t,d,c=a(this);-1==window.location.href.indexOf("action=emailstats")&&(d=c.closest("tr")[0].getElementsByTagName("td")[1].innerHTML.split("<div"),$wcap_break_email_text_1=d[0].split("<a"),t=$wcap_break_email_text_1[0],$wcap_user_id=a(this).data("wcap-user-id"),$wcap_cart_status=""),email_body=`\n                <div class="wcap-modal__body">\n                    <div class="wcap-modal__body-inner">\n                        <label for="wcap_edit_guest_email">Update Guest Email:</label>\n                        <input\n                            type="email"\n                            id="wcap_edit_guest_email"\n                            name="wcap_edit_guest_email"\n                            class="wcap_edit_guest_email"\n                            value="${t}"\n                            style="width:256px;"/>\n                        <div class="wcap_edit_footer" style="padding:25px 0px;">\n                            <a\n                                class="button wcap_update_email"\n                                data-wcap-user-id="${$wcap_user_id}"\n                                data-modal-type="ajax">\n                                Update Email Address\n                            </a>\n                        </div>\n                    </div>\n                </div>`,"ajax"==c.data("modal-type")&&(wcap_clicked_cart_id=c.data("wcap-cart-id"),Modal.open("type-ajax"),a(".wcap-modal-cart-content-hide").hide())},open:function(e){a(document.body).addClass("wcap-modal-open").append('<div class="wcap-modal-overlay"></div>');var t='<div class="wcap-modal '+e+'"><div class="wcap-modal__contents"> <div class="wcap-modal__header"><h1>Cart #'+wcap_clicked_cart_id+"</h1>"+$wcap_cart_status+"</div>"+email_body+' <div class = "wcap-modal-cart-content-hide" id ="wcap_remove_class">  </div> </div>  <div class="wcap-icon-close wcap-js-close-modal"></div>    </div>';a(document.body).append(t),this.position()},loading:function(){a(document.body).addClass("wcap-modal-loading")},contents:function(e){a(document.body).removeClass("wcap-modal-loading"),e=e.replace(/\\(.)/gm,"$1"),a(".wcap-modal__contents").html(e),this.position()},close:function(){a(document.body).removeClass("wcap-modal-open wcap-modal-loading"),a(".wcap-modal, .wcap-modal-overlay").remove()},position:function(){a(".wcap-modal__body").removeProp("style");var e=a(".wcap-modal__header").outerHeight(),t=a(".wcap-modal").height(),d=a(".wcap-modal").width(),c=a(".wcap-modal__body").outerHeight()+e;a(".wcap-modal").css({"margin-left":-d/2,"margin-top":-t/2}),t<c-5&&a(".wcap-modal__body").height(t-e)},search_order:function(e){var t=parseInt(a("#wcap_link_wc_order").val());if(isNaN(t))t=a("#wcap_hidden_order_id").val();if(t>0){var d={action:"wcap_json_search_wc_order",order_id:t};a.post(ajaxurl,d,function(e){"failed"===e?a("#wcap_link_wc_order").val(wcap_abandoned_cart_params.order_id_not_found_msg):(a("#wcap_hidden_order_id").val(t),a("#wcap_link_wc_order").val(e))})}else a("#wcap_link_wc_order").val(wcap_abandoned_cart_params.validation_error_order_id)},mark_recovered_popup:function(e){e.preventDefault();var t=a(this),d=t.data("wcap-cart-id");$wcap_cart_status="",email_body=`\n                <div class="wcap-modal__body">\n                    <div class="wcap-modal__body-inner">\n                        <div>\n                        <p>${wcap_abandoned_cart_params.recovered_display_text}</p>\n                            <input\n                                id="wcap_link_wc_order"\n                                name="wcap_link_wc_order"\n                                class="wcap_link_wc_order"\n                                style="width:60%; height: 30px;"\n                                placeholder="${wcap_abandoned_cart_params.order_id_txt_placeholder}" />\n                            <a\n                                class="button wcap_search_wc_order"\n                                data-wcap-cart-id="${d}"\n                                data-modal-type="ajax">\n                                ${wcap_abandoned_cart_params.search_button_txt}\n                            </a>\n                        </div>\n                        <input\n                            type="hidden"\n                            id="wcap_hidden_order_id"\n                            class="wcap_hidden_order_id"\n                            value="" />\n                        <div class="wcap_edit_footer" style="padding:25px 0px;">\n                            <a\n                                class="button wcap_mark_recovered_admin"\n                                data-wcap-cart-id="${d}"\n                                data-modal-type="ajax">\n                                ${wcap_abandoned_cart_params.mark_recovered_txt}\n                            </a>\n                        </div>\n                    </div>\n                </div>`,"ajax"==t.data("modal-type")&&(wcap_clicked_cart_id=t.data("wcap-cart-id"),Modal.open("type-ajax"),a(".wcap-modal-cart-content-hide").hide())},wcap_admin_unsubscribe:function(){var e=a(this),t={action:"wcap_admin_unsubscribe_cart",wcap_cart_id:wcap_clicked_cart_id=e.data("wcap-cart-id")};return e.text("Processing..."),a.post(ajaxurl,t,function(t){e.text(t.data),setTimeout(function(){a(".wcap-js-close-modal").click(),location.reload()},500)}),!1},wcap_update_email:function(){const e=a(this),t={action:"wcap_edit_guest_email",wcap_user_id:e.data("wcap-user-id"),wcap_email:a(".wcap_edit_guest_email").val()};return e.text("Processing..."),a.post(ajaxurl,t,function(t){e.text(t.data),setTimeout(function(){a(".wcap-js-close-modal").click(),location.reload()},500)}),!1},mark_recovered_update:function(){const e=a("#wcap_hidden_order_id").val(),t=a(this).data("wcap-cart-id");recovered_data={order_id:e,cart_id:t,action:"wcap_mark_recovered_admin"},a.post(ajaxurl,recovered_data,function(e){setTimeout(function(){a(".wcap-js-close-modal").click(),location.reload()},500)})}}).init()});