"use strict";(function(){jQuery(document).ready(function(a){var i,t,r,o,n,s,d,c,l,_,u,e,m,p,f,x,h,v,w;return x={},o=a.WCBackboneModal.View,w=function(o,r,n,i,a,s){var d,c,l;return l=o.length,a=a||25,s=s||l,c=0,d=function(){var e,t;for(t=+new Date,e=c;c<l&&c-e<s&&new Date-t<50;)r.call(n,o[c]),c+=1;return c<l?setTimeout(d,a):i(o)},setTimeout(d,25)},h=function(e){var t,r;return r={},t=function(e,t){var o;t.name=t.name.replace("[]",""),null!=(o=r[t.name])?a.isArray(o)?o.push(t.value):r[t.name]=[o,t.value]:r[t.name]=t.value},a.each(a(e).serializeArray(),t),r},v=function(e){return a("#wc-backbone-modal-dialog .modal-close").trigger("click"),e.button_class=e.button_class||"",new o({target:"wc-customer-order-xml-export-suite-modal",string:e})},l=function(e,t,o){var r,n;return r={action:"wc_customer_order_xml_export_suite_create_export",security:wc_customer_order_xml_export_suite_admin.create_export_nonce,export_type:t||"orders",export_query:e,export_method:o||"download"},n=wp.template("wc-customer-order-xml-export-suite-modal-body-export-started"),v({title:wc_customer_order_xml_export_suite_admin.i18n.export_started,body:n({export_method:o}),action:wc_customer_order_xml_export_suite_admin.is_batch_enabled?wc_customer_order_xml_export_suite_admin.i18n.cancel:wc_customer_order_xml_export_suite_admin.i18n.close,button_class:wc_customer_order_xml_export_suite_admin.is_batch_enabled?"cancel-export":""}),a.post(ajaxurl,r).done(function(t){var o;if(a("#wc-backbone-modal-dialog").length)return!1===t.success?u({title:t.data.title,message:t.data.message}):(a("#wc-backbone-modal-dialog").addClass("wc-customer-order-xml-export-suite-"+t.export_id).data("wc-customer-order-xml-export-suite-id",t.export_id),wc_customer_order_xml_export_suite_admin.is_batch_enabled?c(t.export_id):(o=!1,x[t.export_id]=setInterval(function(){if(!o)return o=!0,a.get(t.status_url).done(function(e){return"string"==typeof e?u():(o=!1)===e.success?(d(t.export_id),u(e.data)):"completed"===e.data.status?_(e.data):void 0}).fail(function(e,t,o){return u()})},2e3)))}).fail(function(e,t,o){return u()})},f=function(e){var t,o,r;return r=wp.template("wc-customer-order-xml-export-suite-modal-body-export-started"),v({title:wc_customer_order_xml_export_suite_admin.i18n.export_resumed,body:r({export_method:"download"})}),t=a(".file_actions .resume[data-export-id="+e+"]").parents("tr"),(o=t.find(".export_status mark")).removeClass("paused").addClass("processing"),t.find(".file_actions .resume").addClass("disabled").attr("href","").blur(),t.find(".file_actions .cancel").removeClass("cancel").addClass("delete"),c(e).then(function(e){return o.removeClass("processing").addClass(e),t.find(".file_actions .resume").removeClass("disabled").removeClass("resume").addClass("download")})},c=function(t){return window.onbeforeunload=function(){return wc_customer_order_xml_export_suite_admin.i18n.confirm_export_cancel},a(document).on("wc_customer_order_xml_export_suite_background_export_batch_progress_"+t,function(e,t){return a(".wc-customer-order-xml-export-suite-progress").val(t.percentage)}),a(document).on("click","#btn-ok.cancel-export",function(e){if(confirm(wc_customer_order_xml_export_suite_admin.i18n.confirm_export_cancel))return window.onbeforeunload=null,wc_customer_order_xml_export_suite_background_export_batch_handler.cancelled=t}),wc_customer_order_xml_export_suite_background_export_batch_handler.process_job(t).then(function(e){return window.onbeforeunload=null,a(".wc-customer-order-xml-export-suite-progress").val(100),_(e.data)}).catch(function(e){return a(".wc-customer-order-xml-export-suite-progress").hide(),u(e.data)})},_=function(e){var t;if("download"===e.method||"local"===e.method||"completed"===e.transfer_status)return t=wp.template("wc-customer-order-xml-export-suite-modal-body-export-completed"),v({title:wc_customer_order_xml_export_suite_admin.i18n.export_completed,body:t({export_method:e.method,download_url:e.download_url}),action:wc_customer_order_xml_export_suite_admin.i18n.done}),"download"===e.method&&(window.location.href=e.download_url),d(e.export_id),e.status},u=function(){var e,t,o,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(o=wc_customer_order_xml_export_suite_admin.i18n.unexpected_error,e=wc_customer_order_xml_export_suite_admin.i18n.unexpected_error_message,(t=null)!=r){if(null!=r.status)switch(t=r.status,r.status){case"not-found":o=wc_customer_order_xml_export_suite_admin.i18n.export_not_found;break;case"failed":o=wc_customer_order_xml_export_suite_admin.i18n.export_failed;break;case"completed":o="failed"===r.transfer_status?wc_customer_order_xml_export_suite_admin.i18n.export_transfer_failed:wc_customer_order_xml_export_suite_admin.i18n.export_completed}else null!=r.title&&(o=r.title);null!=r.message&&(e=r.message)}return v({title:o,body:'<p><span class="dashicons dashicons-warning"></span> '+e+"</p>",action:wc_customer_order_xml_export_suite_admin.i18n.close}),t},d=function(e){return a.get(ajaxurl,{action:"wc_plugin_framework_customer_order_xml_export_suite_dismiss_notice",messageid:"wc_customer_order_xml_export_suite_finished_"+e})},wc_customer_order_xml_export_suite_admin.settings_page===pagenow&&("export"===wc_customer_order_xml_export_suite_admin.current_tab&&(e={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_xml_export_suite_admin.calendar_icon_url,buttonImageOnly:!0},a("#start_date").datepicker(e),a("#end_date").datepicker(e),(r=a(".show_if_coupons").closest("tr")).hide(),a("input[name=type]").change(function(){var e,t,o;return t=a(".show_if_orders").closest("tr").add(a("#subscription_orders").closest("table.form-table")).add(a("#subscription_orders").closest("table.form-table").prev("h2")),o=a("#start_date").closest("tr"),e=a("#end_date").closest("tr"),"coupons"===a(this).val()?(r.show(),t.hide(),o.hide(),e.hide()):("customers"===a(this).val()?(o.show(),e.show(),t.hide()):(t.show(),o.show(),e.show()),r.hide())}),a("#mainform").submit(function(e){var t,o;return e.preventDefault(),t=(o=h(this)).type,delete o.type,l(o,t,"download")})),"export_list"===wc_customer_order_xml_export_suite_admin.current_tab&&(a(".file_actions").find(".delete").on("click",function(e){if(!confirm(wc_customer_order_xml_export_suite_admin.i18n.confirm_export_delete))return e.preventDefault()}),a(".file_actions").find(".cancel").on("click",function(e){if(!confirm(wc_customer_order_xml_export_suite_admin.i18n.confirm_export_cancel))return e.preventDefault()}),a(".file_actions").find(".transfer, .email").on("click",function(e){if(!confirm(wc_customer_order_xml_export_suite_admin.i18n.confirm_export_transfer))return e.preventDefault()}),a(".file_actions").find(".resume").on("click",function(e){var t;return e.preventDefault(),(t=a(e.target).data("export-id"))?a(e.target).hasClass("disabled")?void 0:f(t):u()})),"settings"===wc_customer_order_xml_export_suite_admin.current_tab&&(t={ftp:a(".js-auto-export-ftp-field:first").closest("table"),http_post:a(".js-auto-export-http-post-field:first").closest("table"),email:a(".js-auto-export-email-field:first").closest("table")},a(".js-auto-export-trigger").change(function(){var e,t;return t=a(this).val(),e=a(".js-auto-export-schedule-field").closest("tr"),"immediate"===t?e.hide():e.show()}).change(),a(".js-auto-export-method").change(function(){var e,r;return r=a(this).val(),e=a(this).closest("tr").nextUntil("h3"),"disabled"===r?e.hide():(e.show(),a(".js-auto-export-trigger").change()),"local"===r?a(this).next("span.description").show():a(this).next("span.description").hide(),a.each(t,function(e,t){var o;return t[o=e===r?"show":"hide"]().prev()[o]()})}).change(),a(".js-auto-export-timepicker").timepicker({step:5}),a("select.js-auto-export-ftp-security").change(function(){var e,t,o;if(e=a(".js-auto-export-ftp-port"),t=Number(e.val(),10),o=a(this).val(),""===t||-1<[21,22,990].indexOf(t))return"sftp"===o?e.val(22):"ftp_ssl"===o?e.val(990):e.val(21)}).change(),a(".js-auto-export-test-button").on("click",function(){return a("<input>").attr({type:"hidden",id:"wc_customer_order_xml_export_suite_test_method",name:"wc_customer_order_xml_export_suite_test_method",value:a(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_xml_export_suite_admin.current_tab&&(a(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(e){var t,o,r;t=a(this).closest("table"),o=a(this).prop("checked"),r=e.shiftKey||a(this).data("wp-toggle"),t.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!a(this).is(":hidden,:disabled")&&(r?!a(this).prop("checked"):!!o)}),t.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!r&&!!o})}),a(".js-field-name").keyup(function(){return a(this).val(a(this).val().replace(/[^\w\-]/,""))}),i=a(".wc-customer-order-xml-export-suite-field-mapping"),n=function(){var e,t,o,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(t=i.find(".field-mapping-__INDEX__"),o=i.find("tbody tr").length-2,(e=a(t.prop("outerHTML").replace(/__INDEX__/g,o))).find(".enhanced").removeClass("enhanced"),r.key&&(e.find(".js-field-key").val(r.key),"meta"===r.key&&(e.find(".js-field-meta-key-label").show(),r.meta_key&&e.find(".js-field-meta-key").val(r.meta_key)),"static"===r.key&&(e.find(".js-field-static-value-label").show(),r.meta_key&&e.find(".js-field-static-value").val(r.static_value))),r.name&&e.find(".js-field-name").val(r.name),t.before(e),i.find(".no-field-mappings").addClass("hide"),i.find("tfoot .js-remove-field-mapping").removeClass("hide"),n)return a(document.body).trigger("wc-enhanced-select-init")},p=function(e){var t,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:400,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return r=r||function(){},t=function(){return i.find("tbody tr:visible").length<1&&(i.find(".no-field-mappings").removeClass("hide"),i.find(".js-remove-field-mapping").addClass("hide")),i.find('th.check-column input[type="checkbox"]').removeAttr("checked")},o?a.when(a(e).closest("tr.field-mapping").fadeOut(o,function(){var e;return e=a(this),setTimeout(function(){return e.remove()},1)})).then(function(){return t(),setTimeout(r,1)}):(a(e).closest("tr.field-mapping").remove(),t(),r())},m=function(){var r;return r=0,i.find("tr.field-mapping").each(function(e,t){if(!a(t).hasClass("field-mapping-__INDEX__"))return a(t).removeClass(function(e,t){var o,r;if(r=new RegExp("field-mapping-([0-9])*","g"),o=t.match(r))return o[0]}),a(t).addClass("field-mapping-"+r),a("input, select, textarea",t).each(function(e,t){var o;if((o=jQuery(t)).attr("name"))return o.attr("name",o.attr("name").replace(/\[([^[]*)\]/,"["+r+"]"))}),r++})},s=function(t){return a(".wc-customer-order-xml-export-suite-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var e;return t="string"==typeof t?JSON.parse(t):t,a(".js-include-all-meta").prop("checked",!0===t.include_all_meta),t.indent&&a(".js-delimiter").prop("checked",!0===t.indent),t.xml_version&&a(".js-xml-version").select2("val",t.xml_version,!0),t.xml_ending&&a(".js-xml-encoding").val(t.xml_encoding),t.xml_standalone&&a(".js-xml-standalone").prop("checked",!0===t.xml_standalone),p(i.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),e=a.map(t.fields,function(e,t){return"string"==typeof e&&(e={name:e}),e.key||(e.key=t),e}),w(e,n,this,function(){return m(),a(document.body).trigger("wc-enhanced-select-init"),a(".wc-customer-order-xml-export-suite-field-mapping").unblock()})},1)},i.find(".js-add-field-mapping").click(function(e){return e.preventDefault(),n({},!0)}),i.find(".js-remove-field-mapping").click(function(e){var t;return e.preventDefault(),t=i.find('tbody input[type="checkbox"]:checked'),p(t,null,m)}),i.find(".js-load-mapping").click(function(e){return e.preventDefault(),v({title:wc_customer_order_xml_export_suite_admin.i18n.load_mapping,body:a("#tmpl-wc-customer-order-xml-export-suite-modal-body-load-mapping").html(),action:wc_customer_order_xml_export_suite_admin.i18n.load,button_class:"button-primary"})}),a(document.body).on("change","#load-mapping-source",function(e){return"snippet"===a(e.target).val()?a("#load-mapping-snippet").show():a("#load-mapping-snippet").hide()}),a(document.body).on("wc_backbone_modal_response",function(e,t,o){var r;return r="snippet"===o.source?o.snippet?JSON.parse(o.snippet):{fields:{}}:wc_customer_order_xml_export_suite_admin.export_formats[o.source],setTimeout(function(){return s(r)},1)}),i.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:m}),i.on("change","select.js-field-key",function(e){var t,o,r,n,i;if(r=(t=a(e.target)).closest("tr").find(".js-field-name"),o=t.closest("td").find(".js-field-meta-key-label"),n=t.closest("td").find(".js-field-static-value-label"),"meta"===t.val()?o.removeClass("hide").find("input").focus():o.addClass("hide").find("input").val(""),"static"===t.val()?n.removeClass("hide").find("input").focus():n.addClass("hide").find("input").val(""),!r.val()||e.removed&&e.removed.id===r.val())return i="meta"===t.val()?"":t.val(),r.val(i)}),a("#mainform").submit(function(e){return a("tr.field-mapping-__INDEX__").remove()}))),"edit-shop_order"===pagenow&&(a('#posts-filter input[type="submit"].action').on("click",function(e){var t,o,r;if("download_to_xml"===(t=a(e.target).prev("select").val())||"export_to_xml_via_auto_export_method"===t)return e.preventDefault(),r="download_to_xml"===t?"download":"auto_export",o=a.map(a("#posts-filter").find('input[name="post[]"]:checked'),function(e){return Number(a(e).val(),10)}),l({ids:o},"orders",r)}),a(".order_actions .download_to_xml, .wc_actions .download_to_xml").on("click",function(e){var t;return e.preventDefault(),t=a(this).closest("tr").find('th input[name="post[]"]').val(),l({ids:t},"orders","download")})),"shop_order"===pagenow&&a("form#post").submit(function(e){var t,o,r;if((t=a(this).find('select[name="wc_order_action"]').val())&&-1!==["wc_customer_order_xml_export_suite_download","wc_customer_order_xml_export_suite_via_auto_export_method"].indexOf(t))return e.preventDefault(),r="wc_customer_order_xml_export_suite_download"===t?"download":"auto_export",o=[woocommerce_admin_meta_boxes.post_id],l({ids:o},"orders",r)}),"users"===pagenow&&a(".bulkactions #doaction").on("click",function(e){var t,o,r;if("download_to_xml"===(t=a(e.target).prev("select").val())||"export_to_xml_via_auto_export_method"===t)return e.preventDefault(),r="download_to_xml"===t?"download":"auto_export",o=a.map(a(".wp-list-table.users").find('input[name="users[]"]:checked'),function(e){return Number(a(e).val(),10)}),l({ids:o},"customers",r)}),a("body").on("wc_backbone_modal_before_remove",function(e){var t;if((t=a("#wc-backbone-modal-dialog").data("wc-customer-order-xml-export-suite-id"))&&x[t])return clearInterval(x[t])})})}).call(void 0);